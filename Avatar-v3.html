<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ø³Ù†Ø§Ø¨ Ø£ÙØªØ± ÙˆØ§Ù‚Ø¹ÙŠ - Ø­Ø±ÙƒØ© Ø¹Ù…ÙˆØ¯ÙŠØ© ÙÙ‚Ø·</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

  <style>
    body { margin:0; overflow:hidden; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; direction:rtl; }
    #ui {
      position:absolute; bottom:30px; left:50%; transform:translateX(-50%);
      background: rgba(20, 20, 30, 0.7);
      backdrop-filter: blur(10px);
      padding: 14px 22px;
      border-radius: 60px;
      color: white;
      display:flex; gap:14px;
      align-items:center;
      border: 1px solid rgba(255,255,255,0.2);
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      z-index:10;
      direction:ltr;
    }
    #ui label { font-size: 16px; font-weight: 600; }
    #slider {
      width: 240px; height: 8px; border-radius: 10px;
      background: linear-gradient(90deg, #ff4e4e, #ffb84e, #4eff8f);
      -webkit-appearance:none; appearance:none; outline:none; cursor:pointer;
    }
    #slider::-webkit-slider-thumb {
      -webkit-appearance:none;
      width: 22px; height: 22px; background:white; border-radius:50%;
      box-shadow: 0 4px 10px rgba(0,0,0,0.4);
      border: 2px solid #00ccff;
      transition: 0.1s;
    }
    #slider::-webkit-slider-thumb:hover { transform: scale(1.12); background:#f0f0ff; }

    #value {
      font-size: 18px; font-weight: 800; min-width: 90px; text-align:center;
      background: rgba(0,0,0,0.4);
      padding: 7px 14px;
      border-radius: 40px;
      border-left: 3px solid #00ffff;
      box-shadow: inset 0 0 10px rgba(0,255,255,0.3);
      color: #aaffff;
    }

    .btn {
      border: 1px solid rgba(255,255,255,0.22);
      background: rgba(255,255,255,0.10);
      color: #fff;
      padding: 8px 12px;
      border-radius: 999px;
      cursor: pointer;
      font-weight: 700;
      transition: 0.15s;
      user-select: none;
      white-space: nowrap;
    }
    .btn:hover { transform: translateY(-1px); background: rgba(255,255,255,0.16); }
    .btn.active { border-color: rgba(0,255,255,0.75); box-shadow: 0 0 0 2px rgba(0,255,255,0.18) inset; }

    .instructions {
      position:absolute; top:20px; right:20px;
      background: rgba(0,0,0,0.30);
      color: rgba(255,255,255,0.85);
      padding: 8px 16px;
      border-radius: 30px;
      font-size: 14px;
      backdrop-filter: blur(5px);
      border: 1px solid rgba(255,255,255,0.15);
      pointer-events:none;
      z-index:10;
    }
  </style>
</head>

<body>
  <div class="instructions">ğŸ–±ï¸ Ø§Ø³Ø­Ø¨ Ù„ØªØ¯ÙˆÙŠØ± | ğŸ”‹ Ø­Ø±Ù‘Ùƒ Ø§Ù„Ø·Ø§Ù‚Ø© | ğŸ‘¨/ğŸ‘© ÙƒØ¨Ø³ Ù„ØªØºÙŠÙŠØ± ØªØµÙ…ÙŠÙ… Ø¬Ø¯ÙŠØ¯</div>

  <div id="ui">
    <button id="maleBtn" class="btn active">ğŸ‘¨ Ø°ÙƒØ±</button>
    <button id="femaleBtn" class="btn">ğŸ‘© Ø£Ù†Ø«Ù‰</button>
    <button id="regenBtn" class="btn">ğŸ”„ ØªÙˆÙ„ÙŠØ¯ Ø¹Ø´ÙˆØ§Ø¦ÙŠ</button>

    <label>ğŸ”‹ Ø·Ø§Ù‚Ø© Ø§Ù„Ø­ÙŠØ§Ø©</label>
    <input type="range" min="0" max="100" value="65" id="slider">
    <div id="value">65%</div>
  </div>

  <script>
    (function () {
      // ---------- Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© ----------
      const rand = (min, max) => Math.random() * (max - min) + min;
      const randi = (min, max) => Math.floor(rand(min, max + 1));
      const pick = (arr) => arr[Math.floor(Math.random() * arr.length)];
      const clamp = (v, a, b) => Math.max(a, Math.min(b, v));

      function setBtnActive(g) {
        maleBtn.classList.toggle("active", g === "male");
        femaleBtn.classList.toggle("active", g === "female");
      }

      // Ø§Ù„ØªØ®Ù„Øµ Ù…Ù† Ø§Ù„ÙƒØ§Ø¦Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ù„Ù…Ù†Ø¹ ØªØ³Ø±Ø¨ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
      function disposeObject3D(root) {
        root.traverse((obj) => {
          if (obj.geometry) obj.geometry.dispose();
          if (obj.material) {
            if (Array.isArray(obj.material)) obj.material.forEach(m => m.dispose());
            else obj.material.dispose();
          }
        });
      }

      // ---------- Ø§Ù„Ù…Ø´Ù‡Ø¯ ----------
      const scene = new THREE.Scene();
      scene.background = new THREE.Color(0x0b1a2b);
      scene.fog = new THREE.FogExp2(0x0b1a2b, 0.025);

      const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.set(4, 3, 12);
      camera.lookAt(0, 0, 0);

      const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: false });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.shadowMap.enabled = true;
      renderer.shadowMap.type = THREE.PCFSoftShadowMap;
      renderer.outputEncoding = THREE.sRGBEncoding;
      renderer.toneMapping = THREE.ACESFilmicToneMapping;
      renderer.toneMappingExposure = 1.2;
      document.body.appendChild(renderer.domElement);

      const controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.dampingFactor = 0.05;
      controls.autoRotate = false; // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ±Ø§Ù† Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
      controls.enableZoom = true;
      controls.maxPolarAngle = Math.PI / 2;
      controls.minDistance = 5;
      controls.maxDistance = 20;
      controls.target.set(0, 1.8, 0);

      // ---------- Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø© ----------
      scene.add(new THREE.AmbientLight(0x404060, 0.8));

      const sunLight = new THREE.DirectionalLight(0xfff5e6, 1.2);
      sunLight.position.set(5, 10, 7);
      sunLight.castShadow = true;
      sunLight.shadow.mapSize.width = 1024;
      sunLight.shadow.mapSize.height = 1024;
      const d = 12;
      sunLight.shadow.camera.left = -d;
      sunLight.shadow.camera.right = d;
      sunLight.shadow.camera.top = d;
      sunLight.shadow.camera.bottom = -d;
      sunLight.shadow.camera.near = 2;
      sunLight.shadow.camera.far = 30;
      scene.add(sunLight);

      const backLight = new THREE.PointLight(0x4466aa, 0.8);
      backLight.position.set(-5, 2, -5);
      scene.add(backLight);

      const fillLight = new THREE.PointLight(0xaaccff, 0.5);
      fillLight.position.set(3, 2, 5);
      scene.add(fillLight);

      // ---------- Ø§Ù„Ø£Ø±Ø¶ÙŠØ© ----------
      const groundGeometry = new THREE.CircleGeometry(20, 32);
      const groundMaterial = new THREE.MeshStandardMaterial({
        color: 0x1a2b3c, roughness: 0.4, metalness: 0.1, transparent: true, opacity: 0.3
      });
      const ground = new THREE.Mesh(groundGeometry, groundMaterial);
      ground.rotation.x = -Math.PI / 2;
      ground.position.y = -2.8;
      ground.receiveShadow = true;
      scene.add(ground);

      // ---------- Ø¬Ø³ÙŠÙ…Ø§Øª Ø®Ù„ÙÙŠØ© ----------
      const particlesGeo = new THREE.BufferGeometry();
      const particlesCount = 300;
      const posArray = new Float32Array(particlesCount * 3);
      for (let i = 0; i < particlesCount * 3; i += 3) {
        posArray[i] = (Math.random() - 0.5) * 12;
        posArray[i + 1] = (Math.random() - 0.5) * 8;
        posArray[i + 2] = (Math.random() - 0.5) * 12;
      }
      particlesGeo.setAttribute("position", new THREE.BufferAttribute(posArray, 3));
      const particlesMat = new THREE.PointsMaterial({ color: 0xaaccff, size: 0.05, transparent: true, opacity: 0.4 });
      const particles = new THREE.Points(particlesGeo, particlesMat);
      scene.add(particles);

      function animateParticles() {
        const positions = particles.geometry.attributes.position.array;
        for (let i = 1; i < positions.length; i += 3) {
          positions[i] += 0.001;
          if (positions[i] > 5) positions[i] = -5;
        }
        particles.geometry.attributes.position.needsUpdate = true;
      }

      // ---------- Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø£ÙØªØ± ----------
      const avatarRoot = new THREE.Group();
      scene.add(avatarRoot);

      let currentGender = "male";
      let glowMat, heart, avatarGroup;

      // ---------- Ù„ÙˆØ­Ø© Ø£Ù„ÙˆØ§Ù† Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© ----------
      function randomPalette(gender) {
        const skinTones = [
          { skin: 0xf5d0a9, shade: 0xe0b88b },
          { skin: 0xf1c7a1, shade: 0xd9ae86 },
          { skin: 0xeebc95, shade: 0xd1a37d },
          { skin: 0xf6d6b8, shade: 0xe2c0a1 }
        ];

        const maleShirts = [0x222c3a, 0x1f2a44, 0x2b2b33, 0x24304a, 0x20384a];
        const femaleTops = [0x2a3a55, 0x3a2a55, 0x2a553d, 0x55322a, 0x2a4f55];

        const hairColors = [0x2b1e0e, 0x1e1b16, 0x2a2320, 0x3a2b1b];
        const pantsColors = [0x1e1e2f, 0x1d2633, 0x252038, 0x1b1b24];

        const s = pick(skinTones);
        return {
          skin: s.skin,
          shade: s.shade,
          hair: pick(hairColors),
          top: gender === "female" ? pick(femaleTops) : pick(maleShirts),
          pants: pick(pantsColors),
          shoe: pick([0x2c1e1e, 0x1e2a2a, 0x2a1e2a])
        };
      }

      // ---------- Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…ÙˆØ§Ø¯ ----------
      function createMaterials(pal) {
        const skinMat = new THREE.MeshStandardMaterial({ color: pal.skin, roughness: 0.35, flatShading: false });
        const skinMatDarker = new THREE.MeshStandardMaterial({ color: pal.shade, roughness: 0.42 });

        const topMat = new THREE.MeshStandardMaterial({ color: pal.top, roughness: 0.72 });
        const pantsMat = new THREE.MeshStandardMaterial({ color: pal.pants, roughness: 0.82 });
        const shoeMat = new THREE.MeshStandardMaterial({ color: pal.shoe, roughness: 0.92 });

        const eyeWhiteMat = new THREE.MeshStandardMaterial({ color: 0xffffff, roughness: 0.2 });
        const pupilMat = new THREE.MeshStandardMaterial({ color: 0x1a1a2e, roughness: 0.1 });

        const hairMat = new THREE.MeshStandardMaterial({ color: pal.hair, roughness: 0.85 });

        return { skinMat, skinMatDarker, topMat, pantsMat, shoeMat, eyeWhiteMat, pupilMat, hairMat };
      }

      // ---------- Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹ÙŠÙ† ----------
      function createEye(group, mats, x, y, z) {
        const white = new THREE.Mesh(new THREE.SphereGeometry(0.42, 32, 32), mats.eyeWhiteMat);
        white.position.set(x, y, z);
        white.castShadow = true;
        group.add(white);

        const iris = new THREE.Mesh(
          new THREE.SphereGeometry(0.24, 32, 32),
          new THREE.MeshStandardMaterial({ color: pick([0x4a2f1b, 0x2f4a3a, 0x2b2f4a]), roughness: 0.2 })
        );
        iris.position.set(x, y, z + 0.18);
        iris.castShadow = true;
        group.add(iris);

        const pupil = new THREE.Mesh(new THREE.SphereGeometry(0.12, 24, 24), mats.pupilMat);
        pupil.position.set(x, y, z + 0.28);
        pupil.castShadow = true;
        group.add(pupil);

        const gleam = new THREE.Mesh(
          new THREE.SphereGeometry(0.06, 16, 16),
          new THREE.MeshStandardMaterial({ color: 0xffffff, emissive: 0x444444 })
        );
        gleam.position.set(x + 0.1, y + 0.08, z + 0.35);
        group.add(gleam);
      }

      // ---------- Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø°Ø±Ø§Ø¹ ----------
      function createArm(group, mats, side) {
        const armGroup = new THREE.Group();

        const upperArmGeo = new THREE.CylinderGeometry(0.45, 0.4, 1.6, 10);
        const upperArm = new THREE.Mesh(upperArmGeo, mats.topMat);
        upperArm.position.y = 0;
        upperArm.castShadow = true;
        upperArm.receiveShadow = true;
        armGroup.add(upperArm);

        const forearmGeo = new THREE.CylinderGeometry(0.4, 0.35, 1.4, 8);
        const forearm = new THREE.Mesh(forearmGeo, mats.skinMat);
        forearm.position.y = -1.2;
        forearm.castShadow = true;
        armGroup.add(forearm);

        const handGeo = new THREE.SphereGeometry(0.5, 12, 12);
        const hand = new THREE.Mesh(handGeo, mats.skinMat);
        hand.position.y = -2.1;
        hand.scale.set(0.7, 0.4, 0.5);
        hand.castShadow = true;
        armGroup.add(hand);

        armGroup.position.x = side * 1.6;
        armGroup.position.y = 2.4;
        armGroup.position.z = 0.2;
        
        armGroup.rotation.z = side * 0.15;
        armGroup.rotation.x = 0.2;

        group.add(armGroup);
      }

      // ---------- Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø³Ø§Ù‚ ----------
      function createLeg(group, mats, side) {
        const legGroup = new THREE.Group();

        const thighGeo = new THREE.CylinderGeometry(0.55, 0.5, 2.4, 8);
        const thigh = new THREE.Mesh(thighGeo, mats.pantsMat);
        thigh.castShadow = true;
        legGroup.add(thigh);

        const calfGeo = new THREE.CylinderGeometry(0.45, 0.4, 1.8, 8);
        const calf = new THREE.Mesh(calfGeo, mats.pantsMat);
        calf.position.y = -1.8;
        calf.castShadow = true;
        legGroup.add(calf);

        const shoeGeo = new THREE.BoxGeometry(0.8, 0.5, 1.2);
        const shoe = new THREE.Mesh(shoeGeo, mats.shoeMat);
        shoe.position.set(0, -2.9, 0.3);
        shoe.castShadow = true;
        legGroup.add(shoe);

        legGroup.position.x = side * 0.7;
        legGroup.position.y = -1.0;
        legGroup.position.z = 0.1;

        group.add(legGroup);
      }

      // ---------- Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø´Ø¹Ø± ----------
      function createHair(group, mats, gender) {
        if (gender === "male") {
          const hairMainGeo = new THREE.SphereGeometry(1.7, 32, 16, 0, Math.PI * 2, 0, Math.PI / 2);
          const hairMain = new THREE.Mesh(hairMainGeo, mats.hairMat);
          hairMain.position.set(0, 4.9, 0.2);
          hairMain.scale.set(rand(1.05, 1.15), rand(0.38, 0.52), rand(0.95, 1.05));
          hairMain.castShadow = true;
          group.add(hairMain);

          const hairSideGeo = new THREE.SphereGeometry(0.6, 16, 16);
          const hairSideL = new THREE.Mesh(hairSideGeo, mats.hairMat);
          hairSideL.position.set(-1.1, 4.5, 0.7);
          hairSideL.scale.set(0.8, 0.5, 0.5);
          hairSideL.castShadow = true;
          group.add(hairSideL);

          const hairSideR = hairSideL.clone();
          hairSideR.position.set(1.1, 4.5, 0.7);
          group.add(hairSideR);

          if (Math.random() < 0.65) {
            const beardGeo = new THREE.SphereGeometry(1.5, 24, 16, 0, Math.PI * 2, Math.PI / 3, Math.PI / 2);
            const beard = new THREE.Mesh(beardGeo, mats.hairMat);
            beard.position.set(0, 2.9, 1.2);
            beard.scale.set(rand(1.10, 1.28), rand(0.28, 0.45), rand(0.70, 0.88));
            beard.castShadow = true;
            group.add(beard);
          }
        } else {
          const hairCapGeo = new THREE.SphereGeometry(1.75, 36, 20, 0, Math.PI * 2, 0, Math.PI / 2);
          const hairCap = new THREE.Mesh(hairCapGeo, mats.hairMat);
          hairCap.position.set(0, 4.95, 0.15);
          hairCap.scale.set(rand(1.05, 1.18), rand(0.42, 0.55), rand(1.00, 1.12));
          hairCap.castShadow = true;
          group.add(hairCap);

          const backHairGeo = new THREE.SphereGeometry(1.35, 24, 18);
          const backHair = new THREE.Mesh(backHairGeo, mats.hairMat);
          backHair.position.set(0, 3.95, -0.75);
          backHair.scale.set(rand(1.10, 1.30), rand(1.25, 1.55), rand(0.55, 0.75));
          backHair.castShadow = true;
          group.add(backHair);

          if (Math.random() < 0.55) {
            const bunGeo = new THREE.SphereGeometry(0.55, 18, 18);
            const bun = new THREE.Mesh(bunGeo, mats.hairMat);
            bun.position.set(0, 5.45, -0.25);
            bun.scale.set(rand(0.9, 1.1), rand(0.9, 1.1), rand(0.9, 1.1));
            bun.castShadow = true;
            group.add(bun);
          }
        }
      }

      // ---------- ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙˆØ¬Ù‡ ----------
      function createFaceDetails(group, mats, gender) {
        const browMat = new THREE.MeshStandardMaterial({ color: mats.hairMat.color.getHex() });
        const browGeo = new THREE.BoxGeometry(0.8, 0.15, 0.2);

        const browL = new THREE.Mesh(browGeo, browMat);
        browL.position.set(-0.75, 4.2, 1.7);
        browL.rotation.z = rand(0.05, 0.14);
        browL.castShadow = true;
        group.add(browL);

        const browR = browL.clone();
        browR.position.set(0.75, 4.2, 1.7);
        browR.rotation.z = -rand(0.05, 0.14);
        group.add(browR);

        const noseGeo = new THREE.ConeGeometry(rand(0.26, 0.34), rand(0.62, 0.78), 16);
        const nose = new THREE.Mesh(noseGeo, mats.skinMatDarker);
        nose.position.set(0, 3.3, 2.0);
        nose.rotation.x = 0.2;
        nose.castShadow = true;
        group.add(nose);

        const mouthColor = gender === "female" ? 0xb03a66 : 0x992244;
        const mouthGeo = new THREE.TorusGeometry(0.3, 0.08, 12, 24, Math.PI);
        const mouth = new THREE.Mesh(mouthGeo, new THREE.MeshStandardMaterial({ color: mouthColor, roughness: 0.4 }));
        mouth.position.set(0, 2.7, 2.0);
        mouth.rotation.x = 0.1;
        mouth.scale.set(1, gender === "female" ? 0.45 : 0.35, 1);
        group.add(mouth);
      }

      // ---------- Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø³Ù… ----------
      function createBody(group, mats, gender) {
        const headGeo = new THREE.SphereGeometry(1.65, 64, 64);
        const head = new THREE.Mesh(headGeo, mats.skinMat);
        head.position.y = 3.4;
        head.castShadow = true;
        head.receiveShadow = true;
        group.add(head);

        const jawGeo = new THREE.SphereGeometry(1.5, 32, 32, 0, Math.PI * 2, 0, Math.PI / 2);
        const jaw = new THREE.Mesh(jawGeo, mats.skinMatDarker);
        jaw.position.set(0, 2.8, 0.3);
        jaw.scale.set(gender === "female" ? 1.02 : 1.10, gender === "female" ? 0.62 : 0.70, 0.9);
        jaw.castShadow = true;
        group.add(jaw);

        createEye(group, mats, -0.65, 3.85, 1.6);
        createEye(group, mats, 0.65, 3.85, 1.6);

        const torsoGeo = new THREE.CylinderGeometry(gender === "female" ? 1.2 : 1.3, gender === "female" ? 1.3 : 1.4, 3.2, 12);
        const torso = new THREE.Mesh(torsoGeo, mats.topMat);
        torso.position.y = 1.4;
        torso.castShadow = true;
        torso.receiveShadow = true;
        group.add(torso);

        const collarGeo = new THREE.TorusGeometry(gender === "female" ? 1.1 : 1.2, 0.1, 8, 20, Math.PI / 2);
        const collar = new THREE.Mesh(collarGeo, mats.topMat);
        collar.position.set(0, 2.9, 0.7);
        collar.rotation.x = 0.3;
        collar.scale.set(1, 0.5, 0.6);
        group.add(collar);

        if (gender === "female" && Math.random() < 0.45) {
          const skirtGeo = new THREE.CylinderGeometry(1.15, 1.55, 1.6, 16, 1, true);
          const skirt = new THREE.Mesh(skirtGeo, mats.pantsMat);
          skirt.position.y = -0.6;
          skirt.castShadow = true;
          skirt.receiveShadow = true;
          group.add(skirt);
        } else {
          const pantsGeo = new THREE.CylinderGeometry(1.1, 0.9, 2.4, 8);
          const pants = new THREE.Mesh(pantsGeo, mats.pantsMat);
          pants.position.y = -0.3;
          pants.castShadow = true;
          pants.receiveShadow = true;
          group.add(pants);

          createLeg(group, mats, -1);
          createLeg(group, mats, 1);
        }

        createArm(group, mats, -1);
        createArm(group, mats, 1);
        createFaceDetails(group, mats, gender);
      }

      // ---------- Ù…Ø¤Ø«Ø±Ø§Øª Ø§Ù„Ø·Ø§Ù‚Ø© ----------
      function createEnergyFX(group) {
        glowMat = new THREE.MeshPhongMaterial({
          color: 0x33aaff,
          emissive: 0x2266cc,
          transparent: true,
          opacity: 0.25,
          side: THREE.BackSide
        });
        
        const glowSphere = new THREE.Mesh(new THREE.SphereGeometry(1.8, 32, 16), glowMat);
        glowSphere.position.set(0, 1.8, 0.5);
        glowSphere.scale.set(1.0, 0.8, 0.6);
        group.add(glowSphere);

        const heartMat = new THREE.MeshStandardMaterial({ color: 0xff3366, emissive: 0x441122 });
        const heartGeo = new THREE.SphereGeometry(0.5, 16, 16);
        heart = new THREE.Mesh(heartGeo, heartMat);
        heart.position.set(0, 1.8, 1.2);
        heart.scale.set(0.6, 0.6, 0.3);
        group.add(heart);
      }

      // ---------- ØªØºÙŠÙŠØ±Ø§Øª Ø¨Ø³ÙŠØ·Ø© ÙÙŠ Ø§Ù„Ù…Ø²Ø§Ø¬ ----------
      function randomizeSceneMood() {
        renderer.toneMappingExposure = rand(1.05, 1.35);
        scene.fog.density = rand(0.020, 0.032);
        fillLight.intensity = rand(0.35, 0.65);
        backLight.intensity = rand(0.6, 1.0);
      }

      // ---------- Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙØªØ± Ø¬Ø¯ÙŠØ¯ ----------
      function generateAvatar(gender) {
        currentGender = gender;
        setBtnActive(gender);

        if (avatarGroup) {
          avatarRoot.remove(avatarGroup);
          disposeObject3D(avatarGroup);
        }

        avatarGroup = new THREE.Group();
        avatarGroup.position.y = 0;
        avatarRoot.add(avatarGroup);

        randomizeSceneMood();

        const pal = randomPalette(gender);
        const mats = createMaterials(pal);

        createBody(avatarGroup, mats, gender);
        createHair(avatarGroup, mats, gender);
        createEnergyFX(avatarGroup);

        slider.dispatchEvent(new Event("input"));
      }

      // ---------- Ø´Ø±ÙŠØ· Ø§Ù„Ø·Ø§Ù‚Ø© ----------
      const slider = document.getElementById("slider");
      const valueDiv = document.getElementById("value");

      slider.addEventListener("input", (e) => {
        const val = parseInt(e.target.value, 10);
        valueDiv.innerText = val + "%";

        const intensity = clamp(val / 100, 0, 1);

        if (glowMat) {
          glowMat.emissive.setHSL(0.6, 1, 0.3 * intensity);
          glowMat.opacity = 0.2 + intensity * 0.3;
        }

        if (heart && heart.material && heart.material.emissive) {
          heart.material.emissive.setHSL(0.98, 1, 0.12 * intensity);
        }

        // autoRotateSpeed Ù„Ù… Ù†Ø¹Ø¯ Ù†Ø³ØªØ®Ø¯Ù…Ù‡ Ù„Ø£Ù† autoRotate = false
      });

      // ---------- Ø§Ù„Ø£Ø²Ø±Ø§Ø± ----------
      const maleBtn = document.getElementById("maleBtn");
      const femaleBtn = document.getElementById("femaleBtn");
      const regenBtn = document.getElementById("regenBtn");

      maleBtn.addEventListener("click", () => generateAvatar("male"));
      femaleBtn.addEventListener("click", () => generateAvatar("female"));
      regenBtn.addEventListener("click", () => generateAvatar(currentGender));

      // Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØªØ´ØºÙŠÙ„
      generateAvatar("male");

      // ---------- Ø­Ù„Ù‚Ø© Ø§Ù„ØªØ­Ø±ÙŠÙƒ (Ø­Ø±ÙƒØ© Ø¹Ù…ÙˆØ¯ÙŠØ© ÙÙ‚Ø·) ----------
      let timeOffset = 0;
      function animate() {
        requestAnimationFrame(animate);

        // Ø­Ø±ÙƒØ© Ø¹Ù…ÙˆØ¯ÙŠØ© Ø®ÙÙŠÙØ© (float)
        timeOffset += 0.01;
        if (avatarRoot) {
          avatarRoot.position.y = Math.sin(timeOffset) * 0.1; // Ø­Ø±ÙƒØ© Ø®ÙÙŠÙØ© Ù„Ø£Ø¹Ù„Ù‰ ÙˆØ£Ø³ÙÙ„
        }

        particles.rotation.y += 0.0002;
        animateParticles();

        controls.update();
        renderer.render(scene, camera);
      }
      animate();

      window.addEventListener("resize", () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });
    })();
  </script>
</body>
</html>