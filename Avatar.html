<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Avatar Upgrade</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<style>
body{
    margin:0;
    overflow:hidden;
    background: radial-gradient(circle at center, #0f172a 0%, #020617 80%);
    font-family: Arial;
    color:white;
}
#ui{
    position:absolute;
    top:20px;
    left:20px;
    z-index:10;
}
input{ width:200px; }
#badge{
    margin-top:10px;
    color:gold;
    display:none;
}
</style>
</head>
<body>

<div id="ui">
    <h2>Energy Level</h2>
    <input type="range" min="0" max="100" value="30" id="slider">
    <div id="value">Energy: 30%</div>
    <div id="badge">üèÜ MAX ENERGY</div>
</div>

<script>

// ================= Scene =================
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.z = 12;

// ================= Renderer =================
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.outputEncoding = THREE.sRGBEncoding;
renderer.physicallyCorrectLights = true;
renderer.shadowMap.enabled = true;
document.body.appendChild(renderer.domElement);

// ================= Lights =================
scene.add(new THREE.AmbientLight(0xffffff,0.35));

const hemi = new THREE.HemisphereLight(0xffeeb1, 0x080820, 0.9);
scene.add(hemi);

const keyLight = new THREE.DirectionalLight(0xffffff,1.2);
keyLight.position.set(5,10,5);
keyLight.castShadow = true;
scene.add(keyLight);

// ================= Avatar =================
const avatar = new THREE.Group();
scene.add(avatar);

// ground shadow
const ground = new THREE.Mesh(
    new THREE.CircleGeometry(6,64),
    new THREE.ShadowMaterial({opacity:0.25})
);
ground.rotation.x = -Math.PI/2;
ground.position.y = -5.5;
ground.receiveShadow = true;
scene.add(ground);

// ================= BODY =================
const bodyMaterial = new THREE.MeshPhysicalMaterial({
    color:0x2563eb,
    roughness:0.6,
    metalness:0.05,
    clearcoat:0.2,
    emissive:0x00ffff,
    emissiveIntensity:0.15
});

const body = new THREE.Mesh(
    new THREE.CylinderGeometry(1.15,1.25,5,64),
    bodyMaterial
);
body.castShadow = true;
avatar.add(body);

// ================= HEAD (Snap Style) =================
const skinMaterial = new THREE.MeshPhysicalMaterial({
    color:0xffd6a5,
    roughness:0.55,
    metalness:0.0,
    clearcoat:0.15,
    clearcoatRoughness:0.4
});

const head = new THREE.Mesh(
    new THREE.SphereGeometry(1.35,64,64),
    skinMaterial
);
head.position.y = 4.1;
head.scale.set(1,1.05,1);
head.castShadow = true;
avatar.add(head);

// ================= EYES =================
const eyeWhiteMaterial = new THREE.MeshPhysicalMaterial({
    color:0xffffff,
    roughness:0.2,
    clearcoat:1
});

const eyeMaterial = new THREE.MeshPhysicalMaterial({
    color:0x111111,
    roughness:0.3
});

const eyeWhiteGeo = new THREE.SphereGeometry(0.26,32,32);
const pupilGeo = new THREE.SphereGeometry(0.12,32,32);

const leftEyeWhite = new THREE.Mesh(eyeWhiteGeo, eyeWhiteMaterial);
leftEyeWhite.position.set(-0.45,4.35,1.15);
avatar.add(leftEyeWhite);

const rightEyeWhite = new THREE.Mesh(eyeWhiteGeo, eyeWhiteMaterial);
rightEyeWhite.position.set(0.45,4.35,1.15);
avatar.add(rightEyeWhite);

const leftEye = new THREE.Mesh(pupilGeo, eyeMaterial);
leftEye.position.set(-0.45,4.35,1.28);
avatar.add(leftEye);

const rightEye = new THREE.Mesh(pupilGeo, eyeMaterial);
rightEye.position.set(0.45,4.35,1.28);
avatar.add(rightEye);

// ================= EYEBROWS =================
const browMaterial = new THREE.MeshStandardMaterial({color:0x222222});

function createBrow(x){
    const brow = new THREE.Mesh(
        new THREE.BoxGeometry(0.45,0.08,0.08),
        browMaterial
    );
    brow.position.set(x,4.65,1.15);
    brow.rotation.z = x < 0 ? -0.15 : 0.15;
    avatar.add(brow);
}

createBrow(-0.45);
createBrow(0.45);

// ================= MOUTH =================
const mouth = new THREE.Mesh(
    new THREE.TorusGeometry(0.28,0.05,16,100,Math.PI),
    new THREE.MeshStandardMaterial({color:0x7a1f1f})
);
mouth.position.set(0,3.75,1.18);
mouth.rotation.x = Math.PI;
avatar.add(mouth);

// ================= HAIR =================
const hair = new THREE.Mesh(
    new THREE.SphereGeometry(1.25,64,64,0,Math.PI*2,0,Math.PI/2),
    new THREE.MeshStandardMaterial({
        color:0x1e1e1e,
        roughness:0.7,
        metalness:0.1
    })
);
hair.scale.set(1.05,1.1,1.05);
hair.position.y = 4.75;
avatar.add(hair);

// ================= ARMS (Safe Smooth) =================
const armMaterial = new THREE.MeshPhysicalMaterial({
    color:0x2563eb,
    roughness:0.6,
    metalness:0.05,
    clearcoat:0.15
});

const shoulderGeo = new THREE.SphereGeometry(0.45, 32, 32);

const leftShoulder = new THREE.Mesh(shoulderGeo, armMaterial);
leftShoulder.position.set(-1.35, 2.2, 0);
avatar.add(leftShoulder);

const rightShoulder = new THREE.Mesh(shoulderGeo, armMaterial);
rightShoulder.position.set(1.35, 2.2, 0);
avatar.add(rightShoulder);

const armGeo = new THREE.CylinderGeometry(0.28, 0.32, 2.6, 32);

const leftArm = new THREE.Mesh(armGeo, armMaterial);
leftArm.position.set(-1.9, 0.9, 0);
leftArm.rotation.z = Math.PI * 0.08;
avatar.add(leftArm);

const rightArm = new THREE.Mesh(armGeo, armMaterial);
rightArm.position.set(1.9, 0.9, 0);
rightArm.rotation.z = -Math.PI * 0.08;
avatar.add(rightArm);

// ================= LEGS =================
const legGeo = new THREE.CylinderGeometry(0.4,0.4,3,32);

const leftLeg = new THREE.Mesh(legGeo, armMaterial);
leftLeg.position.set(-0.7,-4,0);
avatar.add(leftLeg);

const rightLeg = new THREE.Mesh(legGeo, armMaterial);
rightLeg.position.set(0.7,-4,0);
avatar.add(rightLeg);

// ================= ENERGY =================
const energyMaterial = new THREE.MeshStandardMaterial({
    color:0x00ffff,
    emissive:0x00ffff,
    emissiveIntensity:1.5,
    transparent:true,
    opacity:0.6
});

const energy = new THREE.Mesh(
    new THREE.CylinderGeometry(1,1,5,64),
    energyMaterial
);
energy.position.y = -2.5;
energy.scale.y = 0.3;
avatar.add(energy);

// ================= Mouse Rotate =================
let dragging=false;
let prevX=0;

renderer.domElement.addEventListener("mousedown",e=>{
    dragging=true;
    prevX=e.clientX;
});
renderer.domElement.addEventListener("mouseup",()=>dragging=false);

renderer.domElement.addEventListener("mousemove",e=>{
    if(!dragging) return;
    avatar.rotation.y += (e.clientX-prevX)*0.01;
    prevX=e.clientX;
});

// ================= Energy Slider =================
const slider=document.getElementById("slider");
const value=document.getElementById("value");
const badge=document.getElementById("badge");

slider.addEventListener("input",()=>{
    let v=slider.value;
    value.innerText="Energy: "+v+"%";

    let scale=v/100;
    energy.scale.y=scale;
    energy.position.y=-2.5 + (5*scale)/2;

    bodyMaterial.emissiveIntensity=scale*2;
    energyMaterial.emissiveIntensity=scale*3;

    badge.style.display = v==100 ? "block" : "none";
});

// ================= Floating =================
let float=0;
function animate(){
    requestAnimationFrame(animate);
    float+=0.02;
    avatar.position.y=Math.sin(float)*0.3;
    renderer.render(scene,camera);
}
animate();

window.addEventListener("resize",()=>{
    camera.aspect=window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth,window.innerHeight);
});

</script>
</body>
</html>